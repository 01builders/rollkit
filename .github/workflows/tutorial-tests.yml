# Tests / Code Coverage workflow
# This workflow is triggered by ci_release.yml workflow
name: Tests / Code Coverage
on:
  workflow_call:

jobs:
  ignite-gm:
    name: Build Ignite GM Chain
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-go@v5
        with:
          go-version-file: ./go.mod
      - name: Install Rollkit
        run: make install
      - name: Download JavaScript commands file
        run: curl -o commands.js https://raw.githubusercontent.com/rollkit/rollkit/refs/heads/tutorial-test-mvp/.github/workflows/assets/commands.js

      # Install Node.js to interpret JavaScript
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      # Run Rollkit using the command from commands.js
      - name: Run Rollkit Command
        run: |
          node -e "
          import { promises as fs } from 'fs';
          import { execSync } from 'child_process';
          const { default: commands } = await import('./commands.js');
          const command = commands.rollkitStart; // Access predefined command
          console.log('Executing:', command);
          execSync(command, { stdio: 'inherit' });
          "